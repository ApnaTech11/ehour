<project xmlns:artifact="antlib:org.apache.maven.artifact.ant" 
	name="eHourStandaloneDist" default="archive" basedir=".">
	<description>
		Builds eHour WAR dist file (don't mention Maven's assembly plugin..)
	</description>

	<property name="version" value="0.9.0-SNAPSHOT" />

	<property name="base" location="dist" />
	<property name="dist" location="${base}/war/ehour-${version}" />
	<property name="app" location="${dist}/app" />
	<property name="conf" location="${dist}/conf" />
	<property name="sql" location="${dist}/sql" />
	<property name="tomcat" location="${dist}/tomcat" />
	<property name="i18n" location="${dist}/resources/i18n" />

	<path id="maven-ant-tasks.classpath" path="lib/maven-ant-tasks-2.1.1.jar" />
	<typedef resource="org/apache/maven/artifact/ant/antlib.xml"
			uri="antlib:org.apache.maven.artifact.ant"
		   	classpathref="maven-ant-tasks.classpath" />

	<target name="init" depends="clean">
		<mkdir dir="${basedir}" />
		<mkdir dir="${dist}" />
		<mkdir dir="${app}" />
		<mkdir dir="${conf}" />
		<mkdir dir="${dist}/log" />
		<mkdir dir="${i18n}" />
		<mkdir dir="${sql}" />
		<mkdir dir="${sql}/mysql" />
		<mkdir dir="${sql}/postgresql" />
		<mkdir dir="${tomcat}" />
	</target>
	
	<target name="dist" depends="init">
		<copy file="eHour-web/target/eHour-web-${version}.war" tofile="${app}/ehour-${version}.war" />

		<copy todir="${conf}">
			<fileset dir="eHour-standalone/src/dist/prod/conf" excludes=".svn" />
		</copy>

		<copy todir="${i18n}">
		    <fileset dir="eHour-wicketweb/src/dist/i18n" excludes=".svn" />
		</copy>

		<copy todir="${sql}/mysql">
		    <fileset dir="eHour-persistence-mysql/src/sql" excludes=".svn" />
		</copy>

		<copy todir="${sql}/postgresql">
		    <fileset dir="eHour-persistence-postgresql/src/sql" excludes=".svn" />
		</copy>

		<copy todir="${tomcat}">
		    <fileset dir="src/assembly/tomcat" excludes=".svn" />
			<filterset>
				<filter token="VERSION" value="${version}" />
			</filterset>
		</copy>

                <copy todir="${dist}">
                        <fileset dir="src/assembly/txt/common" excludes=".svn" />
                        <fileset dir="src/assembly/txt/war" excludes=".svn" />
                </copy>
	</target>

	<target name="archive" depends="dist">
		<zip destfile="${base}/ehour-${version}-war.zip" basedir="${dist}/.." />
	</target>

	<target name="clean">
		<delete dir="${dist}"  />
	</target>

</project>

